echo "ğŸš€ Running pre-push checks..."

# Get current branch
branch="$(git rev-parse --abbrev-ref HEAD)"

# Prevent direct push to main/master
if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then
  echo "âŒ No puedes pushear directamente a $branch"
  echo "Crea un PR desde una feature branch"
  exit 1
fi

# Run tests if they exist
if [ -f "package.json" ] && grep -q '"test"' package.json; then
  echo "ğŸ§ª Running tests..."
  npm test -- --passWithNoTests || {
    echo "âŒ Tests fallaron. CorrÃ­gelos antes del push."
    exit 1
  }
fi

# Type checking
echo "ğŸ” Running type check..."
npx tsc --noEmit || {
  echo "âŒ Errores de TypeScript encontrados."
  exit 1
}

# Lint check
echo "ğŸ” Running lint check..."
npm run lint || {
  echo "âŒ Errores de linting encontrados."
  exit 1
}

# Build check
echo "ğŸ—ï¸ Running build check..."
npm run build || {
  echo "âŒ Build fallÃ³. Revisa los errores."
  exit 1
}

echo "âœ… All pre-push checks passed! ğŸ‰"